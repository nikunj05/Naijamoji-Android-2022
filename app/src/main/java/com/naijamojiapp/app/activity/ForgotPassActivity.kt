package com.naijamojiapp.app.activityimport android.app.Activityimport android.os.Bundleimport android.text.TextUtilsimport android.util.Logimport android.view.Viewimport android.view.Windowimport android.view.WindowManagerimport android.widget.*import androidx.appcompat.app.AppCompatActivityimport com.androidnetworking.AndroidNetworkingimport com.androidnetworking.common.Priorityimport com.androidnetworking.error.ANErrorimport com.androidnetworking.interfaces.ParsedRequestListenerimport com.naijamojiapp.Rimport com.naijamojiapp.app.customview.CustomDialogimport com.naijamojiapp.app.customview.CustomProgressDialogimport com.naijamojiapp.app.response.ForgotPasswordResponseimport com.naijamojiapp.app.utils.CheckConnectionimport com.naijamojiapp.app.utils.Constantsclass ForgotPassActivity : AppCompatActivity(), View.OnClickListener {    var rlBack: RelativeLayout? = null    var etEmail: EditText? = null    var tvEmailSend: TextView? = null    override fun onCreate(savedInstanceState: Bundle?) {        super.onCreate(savedInstanceState)        requestWindowFeature(Window.FEATURE_NO_TITLE)        window.setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN)        setContentView(R.layout.activity_forgotpassword)        init()    }    private fun init() {        rlBack = findViewById(R.id.rl_back)        rlBack!!.setOnClickListener(this)        etEmail = findViewById(R.id.et_email)        tvEmailSend = findViewById(R.id.tv_email_send)        tvEmailSend!!.setOnClickListener(this)    }    override fun onClick(view: View?) {        when (view!!.id) {            R.id.rl_back -> {                finish()            }            R.id.tv_email_send -> {                if (CheckConnection.getInstance(this).isConnectingToInternet()) {                    if (isValid()) {                        callForgotPassWs()                    }                } else {                    CustomDialog.instance!!.showalert(this, resources.getString(R.string.check_internet_connection))                }            }        }    }    private fun isValid(): Boolean {        if (TextUtils.isEmpty(etEmail!!.getText().toString())) {            CustomDialog.instance!!.showalert(this@ForgotPassActivity, resources.getString(R.string.please_enter_email))            return false        } else {            etEmail!!.setError(null)        }        if (!Constants.INSTANCE.isValidEmail(etEmail!!.getText().toString())) {            CustomDialog.instance!!.showalert(this@ForgotPassActivity, resources.getString(R.string.please_enter_valid_email))            return false        } else {            etEmail!!.setError(null)        }        return true    }    private fun callForgotPassWs() {        val progressDialog = CustomProgressDialog(this@ForgotPassActivity, R.style.progress_dialog_text_style)        progressDialog.show()        AndroidNetworking.post(Constants.INSTANCE.URLLOCAL + Constants.INSTANCE.strWS_forgot_pass)                .addBodyParameter(Constants.INSTANCE.strWS_email, etEmail!!.getText().toString())                .setPriority(Priority.MEDIUM)                .build()                .getAsObject(ForgotPasswordResponse::class.java, object : ParsedRequestListener<ForgotPasswordResponse> {                    override fun onResponse(response: ForgotPasswordResponse?) {                        Log.e("response", response.toString())                        if (progressDialog.isShowing())                            progressDialog.dismiss()                        var mSuccess = false                        Log.e("response", response.toString())                        if (response != null)                            Log.e("response", response.toString())                            if (response!!.status!!.success == (Constants.INSTANCE.one)){                                mSuccess = true                            }                        if (mSuccess) {                            CustomDialog.instance!!.showalert(this@ForgotPassActivity, "Check your email")                            finish()                        } else {                            try {                                CustomDialog.instance!!.showalert(this@ForgotPassActivity, response!!.status!!.message!!)                            } catch (e: Exception) {                                e.printStackTrace()                                CustomDialog.instance!!.showalert(this@ForgotPassActivity, response!!.status!!.message!!)                            }                        }                    }                    override fun onError(anError: ANError) {                        if(anError.errorCode.toString().equals("401")){                            CustomDialog.instance!!.showalert(this@ForgotPassActivity, "Email Id is not available")                        }                        Log.e("error", anError.toString())                        Log.e("error", anError.errorBody)                        Log.e("error", anError.errorCode.toString())                        if (progressDialog != null && progressDialog.isShowing())                            progressDialog.dismiss()                    }                })    }}